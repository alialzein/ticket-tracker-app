--trigger edge function
SELECT net.http_post(
  url := 'https://gdapxyyrvCwknjmcplna.supabase.co/functions/v1/smart-task',
  headers := '{"Content-Type": "application/json", "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdkYXB4eXlydmN3a25qbWNwbG5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MTA0MzAsImV4cCI6MjA3MzA4NjQzMH0.Jla3hIjQuGLBBrsK-vyguEjC7RA0y4o10d8FULSeznc"}'::jsonb,
  body := '{"eventType": "CLIENT_HERO_CHECK"}'::jsonb
) as request_id;




-- Create single night shift cron job at 11 PM GMT (1 AM GMT+2)
SELECT cron.schedule(
  'award-client-hero-night',
  '0 23 * * *',
  $$
  SELECT net.http_post(
    url := 'https://gdapxyyrvcwknjmcplna.supabase.co/functions/v1/smart-task',
    headers := '{"Content-Type": "application/json", "Authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdkYXB4eXlydmN3a25qbWNwbG5hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1MTA0MzAsImV4cCI6MjA3MzA4NjQzMH0.Jla3hIjQuGLBBrsK-vyguEjC7RA0y4o10d8FULSeznc"}'::jsonb,
    body := '{}'::jsonb
  ) as request_id;
  $$
);


-- Step 2: Remove old job
SELECT cron.unschedule('award-client-hero-night');